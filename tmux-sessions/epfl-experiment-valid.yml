name: epfl_experiment
root: ~/
on_project_exit:
  - ssh -X victor@jetson && bash -c "rosnode kill -a; killall -9 rosmaster; killall -9 roscore"; exit
  - ssh -X rpi@raspberry && bash -c "rosnode kill -a; killall -9 rosmaster; killall -9 roscore"; exit
  - docker kill mmuav_audio_cont
  - docker kill hpe_ros_cont

windows:
  - hpe_pc:
      layout: tiled
      # Synchronize all panes of this window, can be enabled before or after the pane commands run.
      # 'before' represents legacy functionality and will be deprecated in a future release, in favour of 'after'
      # synchronize: after
      panes:
        - roscore:
          - docker start -i hpe_ros_cont
          - sleep 2
          - roscore
        - xtion_camera:
          - sleep 5
          - docker exec -it hpe_ros_cont bash
          - waitForRos; roslaunch openni2_launch openni2.launch
        - hpe_inference:
          - sleep 5
          - docker exec -it hpe_ros_cont bash
          - waitForRos; waitForXtionCamera; roslaunch hpe_ros_package nn_inference.launch
        - ref_gen:
          - sleep 5
          - docker exec -it hpe_ros_cont bash
          - waitForRos; waitFor /stickman; roslaunch hpe_ros_package hpe_gen_reference.launch
        - rtsp_stream:
          - sleep 5 && docker exec -it hpe_ros_cont bash
          - waitFor /stickman_cont_area; roslaunch ros_rtsp rtsp_streams.launch
  - rpi_pc:
      layout: tiled
      panes:
        - roscore:
          - ssh -X rpi@raspberry
          - sleep 5; roscore
        - rtsp-uav:
          - ssh rpi@raspberry
          - sleep 45; export DISPLAY=:0; gst-launch-1.0 -v rtspsrc location=rtsp://jetson:8554/full drop-on-latency=true use-pipeline-clock=true do-retransmission=false latency=0 protocols=GST_RTSP_LOWER_TRANS_UDP ! rtph264depay ! h264parse ! avdec_h264 ! autovideosink sync=false
          - wmctrl -r ':ACTIVE:' -b toggle,fullscreen
        - hpe-stream:
          - ssh rpi@raspberry
          - sleep 50; export DISPLAY=:0; gst-launch-1.0 -v rtspsrc location=rtsp://zozan-pc:8554/full drop-on-latency=true use-pipeline-clock=true do-retransmission=false latency=0 protocols=GST_RTSP_LOWER_TRANS_UDP ! rtph264depay ! h264parse ! avdec_h264 ! autovideosink sync=false
  - jetson_pc:
      layout: tiled
      panes:
        - roscore:
          - ssh -X victor@jetson
          - roscore
        - flir_cam:
          - ssh -X victor@jetson
          - waitForRos; roslaunch spinnaker_camera_driver camera.launch
        - rtsp_stream:
          - ssh -X victor@jetson
          - waitFor /camera/image_raw && roslaunch ros_rtsp rtsp_streams.launch
        - px4:
          - ssh -X victor@jetson
          - waitForRos && export ROS_NAMESPACE=drone_1; roslaunch mavros px4.launch fcu_url:=/dev/ttyTHS1:921600 gcs_url:=udp://:14555@192.168.141.244:14550
  - multimaster_network:
      layout: tiled
      panes:
        - hpe-discovery:
          - docker start -i mmuav_audio_cont
          - sleep 5; roscore;
          - sleep 50; rosrun fkie_master_discovery master_discovery
        - hpe-sync:
          - sleep 5; docker exec -it mmuav_audio_cont bash
          - sleep 60; roslaunch fkie_master_sync master_sync.launch
        - jetson-discovery:
          - ssh victor@jetson
          - sleep 50; rosrun fkie_master_discovery master_discovery
        - jetson-sync:
          - ssh victor@jetson
          - sleep 60; roslaunch fkie_master_sync master_sync.launch
  - rpi_dev:
      layout: tiled
      panes:
        - ssh -X rpi@raspberry
  - jetson_dev:
      layout: tiled
      panes:
        - ssh -X victor@jetson
